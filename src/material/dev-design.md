# 材质系统设计

材质是gl资源的包装，gl资源对于材质本身指材质实现的gl program。program对外部分涉及attributes的布局配置，这主要关于这个材质支持什么格式的外部几何数据。还涉及unifroms的布局配置，这主要决定了这个材质支持外部参数的情况。这些是材质本身向外部暴露的借口，材质所要隐藏的实现是program本身的实现，以及其他gl资源，状态的管理实现。

一个材质需要实现向渲染器提供一个program的接口。渲染器本身或其他工具类，实现了这些programs的资源管理。渲染时，渲染器被上层的引擎，指定一个program，program从上述的资源容器中查询缓存，或者更新创建。然后渲染器被提供一组几何数据，以及必要的uniform设置，最后，渲染器被执行渲染，完成一次drawcall。

framework应当对几何数据的布局，即attribute，提供必要的约定。这些约定以常量的形式在各个模块间使用。比如，我们希望我们的mesh数据，都需要符合同一种布局约定。这样做是为了使得我们在实现material时能够保留数据格式的假设，毕竟我们不可能为每一种自定义的几何数据布局提供不同的material实现。我们希望material的实现者，可以引用约定好的布局格式，来使得material能够在framework中被一大类renderobject广泛使用。同时，material的实现者，也能够保证控制所需数据布局的自由度，使得program能写的多自由，material同时也能写的多自由，配合同样自由的geometry实现，能够形成自成一套相互配合的材质几何体系

program是material的核心内容，每一种material实现各自program的生成方法中，势必是有大量的实现是冗余的，这在针对标准约定的情况下格外显著。所以从最底层的shader字符串生成到最上层的数据接口生成，都需要设计一套在program各个层面进行复用的体系，


